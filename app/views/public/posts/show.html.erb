
<div class="container">
  <div class="row">
    <div class="col-md-3" style="margin-top: 50px; text-align: center;">
      <h2>投稿詳細</h2>
    </div>
    <div class="col-md-6" style="margin-top: 50px; text-align: center;">
      <div id="map"></div>
      <table class="table table-inverse">
        <th>画像</th>
          <td>
            <%= image_tag @post.image,:size =>'200x200' %>
          </td>
        </tr>
        <th>タイトル</th>
          <td><%= @post.title %></td>
        </tr>
        <tr>
          <th>内容</th>
          <td><%= @post.introduction %></td>
        </tr>
        <tr>
          <th>ジャンル</th>
          <td><%= @post.genre.genre %></td>
        </tr>
      </table>
    </div>

    <div class="" style="margin-top: 50px; text-align: center;">
      <% if @post.user == current_user %>
      登録情報
      <%= link_to "編集",edit_public_post_path,class: 'btn btn-success' %>
      <%= link_to '削除', public_post_path(@post.id), method: :delete, data: { confirm: '本当に消しますか？', class: 'btn-sm btn-danger' }, class: "btn btn-sm btn-danger"%>
      <% end %>

      <% if @post.favorited_by?(current_user) %>
        <p>
        <%= link_to public_post_cute_path(@post), method: :delete do %>
          <i class="fa-brands fa-gratipay"></i><%= @post.comments.where.not(cute: nil).count %> かわいい
        <% end %>
        </p>
      <% else %>
        <p>
        <%= link_to public_post_cutes_path(@post), method: :post do %>
          <i class="fa-brands fa-gratipay"></i><%= @post.comments.where.not(cute: nil).count %> かわいい
        <% end %>
        </p>
      <% end %>

      <% if @post.favorited_by?(current_user) %>
　　    <p>
      <%= link_to public_post_looks_path(@post), method: :delete do %>
        <i class="fa-solid fa-eye"></i><%= @post.comments.count %> 見た
      <% end %>
        </p>
    <% else %>
        <p>
      <%= link_to public_post_cute_path(@post), method: :post do %>
        <i class="fa-solid fa-eye"></i><%= @post.comments.count %> 見た
      <% end %>
        </p>
    <% end %>
    </div>
  </div>

    <div class="col-md-12" style="margin-top: 50px; text-align: center;">
    <!--コメント機能-->
    <!--publicを記入してネストしている変数をとる-->
    <%= form_with model: [:public,@post,@comment] do |f| %>
      <%= f.text_area :comment, size: "40x5" %>
      <%= f.submit '送信', class: "btn-sm btn-primary" %>
    <% end %>
    <table class="table table-inverse">
      <thead>
        <tr>
          <th>コメント投稿者</th>
          <th>コメント内容</th>
        </tr>
      </thead>
      <tbody>
        <% @comments.each do |comment| %>
          <tr>
            <!--コメント投稿者の名前をとってきたい-->
            <td><%= comment.user.name %></td>
            <td><%= comment.comment %></td>
            <!--今ログインしているUserしか削除ボタンを表示させない。-->
            <% if comment.user == current_user %>
            <td><%= link_to "削除", public_post_comment_path(@post, comment), method: :delete, class: "btn btn-sm btn-danger" %></td>
            <% end %>
          </tr>
        <% end %>
      </tbody>
    </table>
    </div>


<style>
#map{
  height: 250px;
  width: auto;
}
</style>

<script>
function initMap(){
  // latlngで緯度経度を定義
  let latlng = {lat: <%= @post.latitude %>, lng: <%= @post.longitude %>}
  let map = new google.maps.Map(document.getElementById('map'), {
    center: latlng,
    zoom: 15
  });
  let marker = new google.maps.Marker({
                     position: latlng,
                     map: map
                   });
}
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['SECRET_KEY'] %>&callback=initMap" async defer></script>